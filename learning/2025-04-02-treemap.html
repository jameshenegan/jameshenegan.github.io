<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

<style>
body {
  font-family: "Avenir Next", Helvetica, Arial, sans-serif;
  padding: 1em;
  margin: auto;
  max-width: 42em;
  background: #fefefe;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-weight: bold;
}

h1 {
  color: #000000;
  font-size: 28pt;
}

h2 {
  border-bottom: 1px solid #cccccc;
  color: #000000;
  font-size: 24px;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777777;
  background-color: inherit;
  font-size: 14px;
}

hr {
  height: 0.2em;
  border: 0;
  color: #cccccc;
  background-color: #cccccc;
}

p,
blockquote,
ul,
ol,
dl,
li,
table,
pre {
  margin: 15px 0;
}

img {
  max-width: 100%;
}

table {
  border-collapse: collapse;
  width: 100%;
}

table,
th,
td {
  border: 1px solid #eaeaea;

  border-radius: 3px;
  padding: 5px;
}

tr:nth-child(even) {
  background-color: #f8f8f8;
}

a,
a:visited {
  color: #4183c4;
  background-color: inherit;
  text-decoration: none;
}

#message {
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;
  width: 100%;
  height: 60px;
  margin: 6px 0px;
}

button,
#ws {
  font-size: 10pt;
  padding: 4px 6px;
  border-radius: 5px;
  border: 1px solid #bbb;
  background-color: #eee;
}

code,
pre,
#ws,
#message {
  font-family: Monaco, monospace;
  font-size: 10pt;
  border-radius: 3px;
  background-color: #f8f8f8;
  color: inherit;
}

code {
  border: 1px solid #eaeaea;
  margin: 0 2px;
  padding: 0 5px;
}

pre {
  border: 1px solid #cccccc;
  overflow: auto;
  padding: 4px 8px;
}

pre > code {
  border: 0;
  margin: 0;
  padding: 0;
}

#ws {
  background-color: #f8f8f8;
}

.send {
  color: #77bb77;
}
.server {
  color: #7799bb;
}
.error {
  color: #aa0000;
}
</style>


     </head>
  <body><h1 id="visualization">Visualization</h1>
<p>Below is a basic self‑contained HTML file showing how you might adapt
that Observable snippet into a simple web page.</p>
<p>A few notes on changes:</p>
<ol type="1">
<li><strong>Including D3</strong>: We load d3 via a
<code>&lt;script&gt;</code> tag from the d3js.org CDN.</li>
<li><strong><code>DOM.uid</code> replacement</strong>: Observable’s
<code>DOM.uid("something")</code> gives a unique object with
<code>.id</code> and <code>.href</code>. Here, we define a small
<code>uid(name)</code> function that does essentially the same.</li>
<li><strong>Data</strong>: You’ll need to provide your own
<code>data</code> object. Below is a small example.</li>
</ol>
<p>Feel free to copy and paste this directly into a file named (for
example) <code>index.html</code>, open it in your browser, and tweak as
needed.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Treemap Zoom Example<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Load D3 from a CDN --&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://d3js.org/d3.v7.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 1) DEFINE YOUR DATA</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    Replace this with your own data structure. For example:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Root&quot;</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">children</span><span class="op">:</span> [</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Alpha&quot;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Beta&quot;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">80</span> }<span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Gamma&quot;</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">children</span><span class="op">:</span> [</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>              { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Delta&quot;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">40</span> }<span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>              { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Epsilon&quot;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">20</span> }<span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 2) SETUP</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    These are basically the same lines from your Observable code.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> height <span class="op">=</span> <span class="dv">924</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// A function to mimic Observable’s DOM.uid(&quot;leaf&quot;) usage:</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> uidCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">uid</span>(name) {</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Each time we call uid(&quot;leaf&quot;), we generate a new unique ID</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        uidCount<span class="op">++;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> id <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>uidCount<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>          id<span class="op">,</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>          <span class="dt">href</span><span class="op">:</span> <span class="vs">`#</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      <span class="co">// This custom tiling function adapts the built-in binary tiling</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">// for the appropriate aspect ratio when the treemap is zoomed-in.</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">tile</span>(node<span class="op">,</span> x0<span class="op">,</span> y0<span class="op">,</span> x1<span class="op">,</span> y1) {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">treemapBinary</span>(node<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> child <span class="kw">of</span> node<span class="op">.</span><span class="at">children</span>) {</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>          child<span class="op">.</span><span class="at">x0</span> <span class="op">=</span> x0 <span class="op">+</span> (child<span class="op">.</span><span class="at">x0</span> <span class="op">/</span> width) <span class="op">*</span> (x1 <span class="op">-</span> x0)<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>          child<span class="op">.</span><span class="at">x1</span> <span class="op">=</span> x0 <span class="op">+</span> (child<span class="op">.</span><span class="at">x1</span> <span class="op">/</span> width) <span class="op">*</span> (x1 <span class="op">-</span> x0)<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>          child<span class="op">.</span><span class="at">y0</span> <span class="op">=</span> y0 <span class="op">+</span> (child<span class="op">.</span><span class="at">y0</span> <span class="op">/</span> height) <span class="op">*</span> (y1 <span class="op">-</span> y0)<span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>          child<span class="op">.</span><span class="at">y1</span> <span class="op">=</span> y0 <span class="op">+</span> (child<span class="op">.</span><span class="at">y1</span> <span class="op">/</span> height) <span class="op">*</span> (y1 <span class="op">-</span> y0)<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Compute the layout.</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">treemap</span>()<span class="op">.</span><span class="fu">tile</span>(tile)(</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">hierarchy</span>(data)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">sum</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">value</span> <span class="op">-</span> a<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create the scales.</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> width])<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> height])<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Formatting utilities.</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> format <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">&quot;,d&quot;</span>)<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">name</span>(d) {</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Construct a slash-separated name from root down to the current node</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">ancestors</span>()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">reverse</span>()</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;/&quot;</span>)<span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 3) CREATE THE SVG AND RENDER THE TREEMAP</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    We append an &lt;svg&gt; to the page body and run the same rendering.</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;body&quot;</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;svg&quot;</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;viewBox&quot;</span><span class="op">,</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="op">-</span><span class="fl">30.5</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">30</span>])</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> width)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> height <span class="op">+</span> <span class="dv">30</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">&quot;max-width&quot;</span><span class="op">,</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">&quot;font&quot;</span><span class="op">,</span> <span class="st">&quot;10px sans-serif&quot;</span>)<span class="op">;</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>      <span class="co">// This group will hold our initial view</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> group <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;g&quot;</span>)<span class="op">.</span><span class="fu">call</span>(render<span class="op">,</span> <span class="bu">root</span>)<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">render</span>(group<span class="op">,</span> <span class="bu">root</span>) {</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We bind data to groups: all children plus the root itself</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> node <span class="op">=</span> group</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">&quot;g&quot;</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">data</span>(<span class="bu">root</span><span class="op">.</span><span class="at">children</span><span class="op">.</span><span class="fu">concat</span>(<span class="bu">root</span>))</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;g&quot;</span>)<span class="op">;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If node has children (or is the root), make it clickable</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        node</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> d<span class="op">.</span><span class="at">parent</span> <span class="op">:</span> d<span class="op">.</span><span class="at">children</span>))</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;cursor&quot;</span><span class="op">,</span> <span class="st">&quot;pointer&quot;</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> (<span class="bu">event</span><span class="op">,</span> d) <span class="kw">=&gt;</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="fu">zoomout</span>(<span class="bu">root</span>) <span class="op">:</span> <span class="fu">zoomin</span>(d)))<span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tooltip text</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;title&quot;</span>)<span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">name</span>(d)<span class="sc">}\n${</span><span class="fu">format</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Rectangle for each node</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        node</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;rect&quot;</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;id&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">leafUid</span> <span class="op">=</span> <span class="fu">uid</span>(<span class="st">&quot;leaf&quot;</span>))<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>            d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="st">&quot;#fff&quot;</span> <span class="op">:</span> d<span class="op">.</span><span class="at">children</span> <span class="op">?</span> <span class="st">&quot;#ccc&quot;</span> <span class="op">:</span> <span class="st">&quot;#ddd&quot;</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;stroke&quot;</span><span class="op">,</span> <span class="st">&quot;#fff&quot;</span>)<span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Clip path for each node</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        node</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;clipPath&quot;</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;id&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">clipUid</span> <span class="op">=</span> <span class="fu">uid</span>(<span class="st">&quot;clip&quot;</span>))<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;use&quot;</span>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;xlink:href&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`#</span><span class="sc">${</span>d<span class="op">.</span><span class="at">leafUid</span><span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Text label inside each node, respecting its clip path</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        node</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;text&quot;</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;clip-path&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`url(</span><span class="sc">${</span>d<span class="op">.</span><span class="at">clipUid</span><span class="op">.</span><span class="at">href</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;font-weight&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="st">&quot;bold&quot;</span> <span class="op">:</span> <span class="kw">null</span>))</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">&quot;tspan&quot;</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">data</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>            <span class="co">// For the root, use the full path, else just d.data.name</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Then add the numeric value at the end</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="fu">name</span>(d) <span class="op">:</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">split</span>(<span class="ss">/</span><span class="sc">(?</span><span class="ss">=</span><span class="sc">[A-Z][^A-Z])</span><span class="ss">/g</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">concat</span>(<span class="fu">format</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;tspan&quot;</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;y&quot;</span><span class="op">,</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            (d<span class="op">,</span> i<span class="op">,</span> nodes) <span class="kw">=&gt;</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>              <span class="vs">`</span><span class="sc">${</span>(i <span class="op">===</span> nodes<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">1.1</span> <span class="op">+</span> i <span class="op">*</span> <span class="fl">0.9</span><span class="sc">}</span><span class="vs">em`</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;fill-opacity&quot;</span><span class="op">,</span> (d<span class="op">,</span> i<span class="op">,</span> nodes) <span class="kw">=&gt;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>            i <span class="op">===</span> nodes<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">?</span> <span class="fl">0.7</span> <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;font-weight&quot;</span><span class="op">,</span> (d<span class="op">,</span> i<span class="op">,</span> nodes) <span class="kw">=&gt;</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>            i <span class="op">===</span> nodes<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&quot;normal&quot;</span> <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>        group<span class="op">.</span><span class="fu">call</span>(position<span class="op">,</span> <span class="bu">root</span>)<span class="op">;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Position each node:</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">position</span>(group<span class="op">,</span> <span class="bu">root</span>) {</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>        group</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">&quot;g&quot;</span>)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>            d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="vs">`translate(0,-30)`</span> <span class="op">:</span> <span class="vs">`translate(</span><span class="sc">${</span><span class="fu">x</span>(d<span class="op">.</span><span class="at">x0</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">y</span>(d<span class="op">.</span><span class="at">y0</span>)<span class="sc">}</span><span class="vs">)`</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;rect&quot;</span>)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> width <span class="op">:</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">x1</span>) <span class="op">-</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">x0</span>)))</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (d <span class="op">===</span> <span class="bu">root</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">y1</span>) <span class="op">-</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">y0</span>)))<span class="op">;</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>      <span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 4) ZOOM BEHAVIOR</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    Same as the Observable code: we define zoomin and zoomout.</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">zoomin</span>(d) {</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> group0 <span class="op">=</span> group<span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;pointer-events&quot;</span><span class="op">,</span> <span class="st">&quot;none&quot;</span>)<span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> group1 <span class="op">=</span> (group <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">&quot;g&quot;</span>)<span class="op">.</span><span class="fu">call</span>(render<span class="op">,</span> d))<span class="op">;</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="fu">domain</span>([d<span class="op">.</span><span class="at">x0</span><span class="op">,</span> d<span class="op">.</span><span class="at">x1</span>])<span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        y<span class="op">.</span><span class="fu">domain</span>([d<span class="op">.</span><span class="at">y0</span><span class="op">,</span> d<span class="op">.</span><span class="at">y1</span>])<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        svg</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">duration</span>(<span class="dv">750</span>)</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">call</span>((t) <span class="kw">=&gt;</span> group0<span class="op">.</span><span class="fu">transition</span>(t)<span class="op">.</span><span class="fu">remove</span>()<span class="op">.</span><span class="fu">call</span>(position<span class="op">,</span> d<span class="op">.</span><span class="at">parent</span>))</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">call</span>((t) <span class="kw">=&gt;</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>            group1</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">transition</span>(t)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attrTween</span>(<span class="st">&quot;opacity&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">interpolate</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">call</span>(position<span class="op">,</span> d)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span> <span class="fu">zoomout</span>(d) {</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> group0 <span class="op">=</span> group<span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;pointer-events&quot;</span><span class="op">,</span> <span class="st">&quot;none&quot;</span>)<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> group1 <span class="op">=</span> (group <span class="op">=</span> svg<span class="op">.</span><span class="fu">insert</span>(<span class="st">&quot;g&quot;</span><span class="op">,</span> <span class="st">&quot;*&quot;</span>)<span class="op">.</span><span class="fu">call</span>(render<span class="op">,</span> d<span class="op">.</span><span class="at">parent</span>))<span class="op">;</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span><span class="fu">domain</span>([d<span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">x0</span><span class="op">,</span> d<span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">x1</span>])<span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>        y<span class="op">.</span><span class="fu">domain</span>([d<span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">y0</span><span class="op">,</span> d<span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">y1</span>])<span class="op">;</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>        svg</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">duration</span>(<span class="dv">750</span>)</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">call</span>((t) <span class="kw">=&gt;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>            group0</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">transition</span>(t)</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attrTween</span>(<span class="st">&quot;opacity&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">interpolate</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>))</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">call</span>(position<span class="op">,</span> d)</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">call</span>((t) <span class="kw">=&gt;</span> group1<span class="op">.</span><span class="fu">transition</span>(t)<span class="op">.</span><span class="fu">call</span>(position<span class="op">,</span> d<span class="op">.</span><span class="at">parent</span>))<span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>      <span class="co">// End of our script</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>How to use</strong>:</p>
<ol type="1">
<li>Save this as <code>index.html</code>.</li>
<li>Open in your browser (double-click or open via “File → Open”).</li>
<li>You should see a treemap that can be clicked to zoom in and
out.</li>
<li>Tweak the <code>data</code> object to suit your actual data.</li>
</ol>
<h1 id="data-prep">Data Prep</h1>
<p>Below is one straightforward approach in Python (using pandas) that
takes your four‑column DataFrame (<code>industry</code>,
<code>category</code>, <code>group</code>, <code>id</code>) and produces
a nested “hierarchical” JSON structure, suitable for a D3 treemap or
other hierarchical visualization.</p>
<hr />
<h2 id="example-dataframe">1) Example DataFrame</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;industry&#39;</span>: [<span class="st">&#39;A&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;B&#39;</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;category&#39;</span>: [<span class="st">&#39;Cat1&#39;</span>, <span class="st">&#39;Cat1&#39;</span>, <span class="st">&#39;Cat2&#39;</span>, <span class="st">&#39;Cat1&#39;</span>, <span class="st">&#39;Cat2&#39;</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;group&#39;</span>:    [<span class="st">&#39;G1&#39;</span>,   <span class="st">&#39;G1&#39;</span>,   <span class="st">&#39;G2&#39;</span>,   <span class="st">&#39;G3&#39;</span>,   <span class="st">&#39;G4&#39;</span>],</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;id&#39;</span>:       [<span class="st">&#39;id1&#39;</span>,  <span class="st">&#39;id2&#39;</span>,  <span class="st">&#39;id3&#39;</span>,  <span class="st">&#39;id4&#39;</span>,  <span class="st">&#39;id5&#39;</span>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>You might see something like this:</p>
<table>
<thead>
<tr>
<th></th>
<th>industry</th>
<th>category</th>
<th>group</th>
<th>id</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>A</td>
<td>Cat1</td>
<td>G1</td>
<td>id1</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
<td>Cat1</td>
<td>G1</td>
<td>id2</td>
</tr>
<tr>
<td>2</td>
<td>A</td>
<td>Cat2</td>
<td>G2</td>
<td>id3</td>
</tr>
<tr>
<td>3</td>
<td>B</td>
<td>Cat1</td>
<td>G3</td>
<td>id4</td>
</tr>
<tr>
<td>4</td>
<td>B</td>
<td>Cat2</td>
<td>G4</td>
<td>id5</td>
</tr>
</tbody>
</table>
<p>Each <code>id</code> is unique, each <code>id</code> belongs to
exactly one group, each group belongs to a category, and so on.</p>
<hr />
<h2 id="building-the-hierarchy">2) Building the Hierarchy</h2>
<p>Below is a utility function that:</p>
<ol type="1">
<li>Groups by <code>industry -&gt; category -&gt; group</code>.</li>
<li>Gathers the <code>id</code> values at the bottom level.</li>
<li>Produces a nested dictionary.</li>
<li>Converts that dictionary into a final JSON-friendly tree
structure.</li>
</ol>
<blockquote>
<p><strong>Important</strong>: Treemaps in D3 typically expect each node
to have a <code>"name"</code> field, plus either a <code>"value"</code>
or a <code>"children"</code> list. If you want each final
<code>id</code> to appear as a leaf node (with no numeric value), that’s
perfectly fine – you might keep them as <code>"name": "id1"</code> with
no value. If you do want them to have some numeric measure (for example,
“count of 1” or something else), just add <code>"value": 1</code>,
etc.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_hierarchy(df):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Builds a nested hierarchical structure of the form:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">      &quot;name&quot;: &quot;root&quot;,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">      &quot;children&quot;: [</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">        {</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">          &quot;name&quot;: industry_name,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">          &quot;children&quot;: [</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">            {</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">              &quot;name&quot;: category_name,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">              &quot;children&quot;: [</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">                {</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">                  &quot;name&quot;: group_name,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">                  &quot;children&quot;: [</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">                    { &quot;name&quot;: &lt;id1&gt; },</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">                    { &quot;name&quot;: &lt;id2&gt; }</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">                  ]</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">                }</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">              ]</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">          ]</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">      ]</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First, create a nested dictionary structure</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># that looks like: data_dict[industry][category][group] = [list_of_ids]</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    data_dict <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">list</span>)))</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> df.itertuples(index<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        industry, category, group, id_ <span class="op">=</span> row</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        data_dict[industry][category][group].append(id_)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next, convert that nested dictionary into D3-style hierarchy</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    hierarchy <span class="op">=</span> {<span class="st">&quot;name&quot;</span>: <span class="st">&quot;root&quot;</span>, <span class="st">&quot;children&quot;</span>: []}</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> industry_name, categories_dict <span class="kw">in</span> data_dict.items():</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        industry_node <span class="op">=</span> {</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span>: industry_name,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;children&quot;</span>: []</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category_name, groups_dict <span class="kw">in</span> categories_dict.items():</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>            category_node <span class="op">=</span> {</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;name&quot;</span>: category_name,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;children&quot;</span>: []</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> group_name, list_of_ids <span class="kw">in</span> groups_dict.items():</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Leaf nodes: each ID is a child</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If you want each ID to have a &quot;value&quot;, you can do so here</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>                group_node <span class="op">=</span> {</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;name&quot;</span>: group_name,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;children&quot;</span>: [</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                        {<span class="st">&quot;name&quot;</span>: _id} <span class="cf">for</span> _id <span class="kw">in</span> list_of_ids</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                category_node[<span class="st">&quot;children&quot;</span>].append(group_node)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            industry_node[<span class="st">&quot;children&quot;</span>].append(category_node)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        hierarchy[<span class="st">&quot;children&quot;</span>].append(industry_node)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hierarchy</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the nested object</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>tree_data <span class="op">=</span> build_hierarchy(df)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tree_data)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to dump it to JSON (e.g. &quot;data.json&quot;), do:</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co"># with open(&quot;data.json&quot;, &quot;w&quot;) as f:</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     json.dump(tree_data, f, indent=2)</span></span></code></pre></div>
<p>The printed <code>tree_data</code> might look like:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;root&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;A&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Cat1&quot;</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;G1&quot;</span><span class="fu">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;id1&quot;</span> <span class="fu">}</span><span class="ot">,</span> <span class="fu">{</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;id2&quot;</span> <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>          <span class="ot">]</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Cat2&quot;</span><span class="fu">,</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;G2&quot;</span><span class="fu">,</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;id3&quot;</span> <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>          <span class="ot">]</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;B&quot;</span><span class="fu">,</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Cat1&quot;</span><span class="fu">,</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;G3&quot;</span><span class="fu">,</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;id4&quot;</span> <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>          <span class="ot">]</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Cat2&quot;</span><span class="fu">,</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;G4&quot;</span><span class="fu">,</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;id5&quot;</span> <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>          <span class="ot">]</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="using-that-data-in-your-visualization">3) Using That Data in
Your Visualization</h2>
<p>Once you have this JSON file:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;root&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;children&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">...</span><span class="ot">]</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>You can do one of two things in your HTML + JavaScript code:</p>
<ol type="1">
<li><p><strong>Inline the data directly</strong>:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;children&quot;</span><span class="op">:</span> [</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Then feed data to your treemap code as shown earlier.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div></li>
<li><p><strong>Fetch it from an external file
(e.g. <code>data.json</code>)</strong>:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">json</span>(<span class="st">&quot;data.json&quot;</span>)<span class="op">.</span><span class="fu">then</span>((data) <span class="kw">=&gt;</span> {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use data to build the treemap</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Make sure <code>data.json</code> is served in the same directory or a
reachable URL.</p></li>
</ol>
<hr />
<h3 id="adding-numeric-values">Adding Numeric Values</h3>
<p>If your visualization is a <em>treemap</em>, D3 usually expects each
leaf node to have a numeric value it can sum and size accordingly. In
our example, we’ve only set <code>"name": &lt;id&gt;</code>. If that’s
enough for your use case, great! If you’d like each leaf to have, say,
<code>"value": 1"</code>, you could modify the relevant line in the
function:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>group_node <span class="op">=</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;name&quot;</span>: group_name,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;children&quot;</span>: [</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        { <span class="st">&quot;name&quot;</span>: _id, <span class="st">&quot;value&quot;</span>: <span class="dv">1</span> }  <span class="co"># or some other measure</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _id <span class="kw">in</span> list_of_ids</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h3 id="summary">Summary</h3>
<ol type="1">
<li>Use Python and pandas to group your tabular data and build a nested
dictionary.</li>
<li>Convert it into the <em>D3 hierarchical JSON structure</em> with
<code>"name"</code> and <code>"children"</code> fields.</li>
<li>Save or embed the resulting JSON in your web page.</li>
<li>Let your D3 code consume that JSON to create a treemap (or other
hierarchical visualization).</li>
</ol>
<p>This pattern—“group in Python + output hierarchical JSON + load into
D3”—is quite typical for bridging the gap between a tabular data model
and a nested / hierarchical visualization.</p>
    
</body>
</html>